

# Domain vs Widget 决策指南（金融案例）

本文档用于解决一个在金融系统中**极其常见、也极其容易被做错的问题**：

> **一个功能，应该被抽象成 domain，还是 widget？**

错误的决策往往会导致：
- 业务逻辑漂移
- 组件膨胀
- 多产品行为不一致
- 后期难以治理

本指南用于在设计阶段，帮助工程师做出**可长期维护的判断**。

---

## 一、先给出一句核心结论

> **Domain 描述“业务事实与规则本身”，
> Widget 描述“业务场景如何被用户感知和操作”。**

二者关注点不同，但在金融系统中经常同时出现。

---

## 二、Domain 是什么（金融语境）

### Domain 的定义

Domain 是对**业务世界中稳定事实与规则**的建模。

它关注的是：
- 业务对象是什么
- 哪些规则永远成立
- 哪些判断不依赖 UI 或产品形态

### Domain 的典型特征

- ❌ 没有 UI
- ❌ 没有样式
- ❌ 不关心用户如何操作
- ✅ 规则集中、可复用
- ✅ 多产品必须保持一致

---

### 金融领域的 Domain 示例

- 用户身份 / 角色 / 状态
- 账户与余额计算
- 风控规则判断
- 授信条件
- 手续费 / 利率计算逻辑

### 示例判断

> “用户是否具备访问某类功能的资格？”

👉 **Domain 问题**（事实与规则）

---

## 三、Widget 是什么（金融语境）

### Widget 的定义

Widget 是对**一个可感知、可交互的业务场景**的封装。

它关注的是：
- 用户看到了什么
- 用户如何与业务规则交互
- 一个完整的小场景如何发生

---

### Widget 的典型特征

- ✅ 有 UI
- ✅ 有样式
- ✅ 有明确业务语义
- ❌ 不是完整产品
- ❌ 不负责路由与页面结构

---

### 金融领域的 Widget 示例

- PV / 客服聊天卡片
- 风险提示弹窗
- KYC 进度卡片
- 合规说明面板
- 费率解释模块

### 示例判断

> “如何向用户展示风险等级，并提示下一步操作？”

👉 **Widget 问题**（业务场景表达）

---

## 四、决策对照表（强烈推荐使用）

| 问题 | 倾向 Domain | 倾向 Widget |
|----|----|----|
| 是否有 UI | ❌ | ✅ |
| 是否涉及样式 | ❌ | ✅ |
| 是否描述业务事实 | ✅ | ❌ |
| 是否描述用户体验 | ❌ | ✅ |
| 是否会被多个产品共享 | ✅ | ✅ |
| 是否依赖运行环境 | ❌ | ⚠️（通过 adapter） |

---

## 五、典型金融案例拆解

### 案例 1：用户权限判断 + 展示

需求：
- 判断用户是否有权限
- 向用户展示“可访问 / 不可访问”状态

拆解：

- 权限判断逻辑 → **Domain**
- 权限状态的 UI 展示 → **Widget**

> ❌ 不要把权限判断写进 Widget 内部

---

### 案例 2：PV 聊天模块

需求：
- 用户可与金融 PV 沟通
- 多个产品复用

拆解：

- 会话规则 / 合规限制 → **Domain**
- 聊天 UI / 交互流程 → **Widget**

---

### 案例 3：费率说明

需求：
- 统一费率计算规则
- 不同产品展示方式不同

拆解：

- 费率计算 → **Domain**
- 费率说明卡片 → **Widget**

---

## 六、常见错误模式（务必避免）

### ❌ 错误 1：把业务规则写进 Widget

后果：
- 多个 Widget 行为不一致
- 规则难以审计

---

### ❌ 错误 2：把 Widget 当成 Page

后果：
- 组件体积失控
- 无法复用

---

### ❌ 错误 3：把 Domain 当成 utils

后果：
- 业务语义被抹平
- 后期不可维护

---

## 七、推荐决策流程（实操版）

在设计一个功能前，按顺序回答以下问题：

1. 是否存在 UI 或用户交互？
2. 是否表达一个完整业务场景？
3. 是否包含稳定的业务规则？

决策：

- 规则 → Domain
- 场景 → Widget
- 产品组合 → App

---

## 八、一句总结（金融系统视角）

> **Domain 用来保证“业务正确”，
> Widget 用来保证“业务被正确感知”。**

两者职责不同，但必须协同设计。

当判断犹豫时，请优先保护 Domain 的纯度。
