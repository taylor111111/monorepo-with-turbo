

# TODO / Notes

## 金融前端：实时同步（State Sync）这一类高难度问题（先记录，不急着解决）

我观察到金融领域的前端工程里，存在一类非常高难度、但经常被忽略的问题：

- 同一个面板下多个板块需要保持**实时同步**
- 多个 page 之间需要保持**状态一致性**
- state 很大、很复杂，且变化频繁（行情、余额、风控状态、订单状态等）
- 同时还要避免“滥用”：例如全局 store 订阅风暴、事件总线互相通知、组件各自 fetch 造成漂移

> 目前：我暂时不打算解决它，只做记录。
> 这个问题值得被写下来：它的本质不是“缺某个库”，而是“状态所有权（state ownership）”与“同步策略”缺失。

---

### 一句话定性

- **同步问题本质是状态所有权问题**：谁拥有事实状态？谁负责派生？谁订阅？谁能修改？

---

### 常见错误（金融项目里很常见）

1. 把“事实状态”当成“组件 state”（导致同一事实多处来源，漂移）
2. 用全局 store 暴力同步一切（导致订阅风暴、更新风暴、调试地狱）
3. page/模块之间用 event bus 互相通知（丢因果、丢审计、隐性依赖增加）

---

### 更合理的拆解方式（思考备忘）

- **事实层（Single Source of Truth）**：事实只能有一个来源（用户/账户/风控/订单等）
- **派生层（Derived State）**：UI 大量状态应当是 `derived = f(fact)`，尽量不制造新 state
- **订阅层（Selective Subscription）**：谁真的需要强实时？谁只需最终一致？订阅粒度要克制

（这套思路和 `domain / widgets / apps` 的职责划分是同一条逻辑线。）

---

### 现实阻力（记录原因）

在金融领域：

- 这类问题的修复需要架构层面的决策与资源投入
- 看得到问题的人，往往没有权力去解决它
- 在业务（例如 PV）视角里，这种“结构级难题”的优先级可能不如：
  - 做一个可以定制内容的表格
  - 快速支持一个新需求

因此：**先记录、先保留思考**。
是否解决，看缘分、看时机。

---

### 未来如果要做（可选方向）

- 明确“事实状态”的 owner（domain/service 或专门状态源模块）
- 明确“同步策略”由 app 决定，而不是组件各自为战
- 控制订阅粒度，避免全局扩散
- 保留可审计的因果路径（尤其涉及资金/风控/合规）
